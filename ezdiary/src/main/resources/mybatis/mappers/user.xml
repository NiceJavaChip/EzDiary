<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.user">
			<resultMap type="adminAskDTO" id="ask">
				<result property="ask_idx" column="ask_idx"/>
				<result property="ask_cntnt" column="ask_cntnt"/>
				<result property="status" column="status"/>
				<result property="writer" column="writer"/>
				<result property="write_date" column="write_date"/>
				<result property="editor" column="editor"/>
				<result property="edit_date" column="edit_date"/>
			</resultMap>
			<resultMap type="adminAnswerDTO" id="answer">
				<result property="answer_idx" column="answer_idx"/>
				<result property="ask_idx" column="ask_idx"/>
				<result property="answer_cntnt" column="answer_cntnt"/>
				<result property="status" column="status"/>
				<result property="writer" column="writer"/>
				<result property="write_date" column="write_date"/>
				<result property="editor" column="editor"/>
				<result property="edit_date" column="edit_date"/>
			</resultMap>
	        <resultMap type="userDTO" id="userMember">
	           <result property="user_idx" column="user_idx"/>
	           <result property="user_nick" column="user_nick"/>
	           <result property="status" column="status"/>
	           <result property="writer" column="writer"/>
	           <result property="write_date" column="write_date"/>
	           <result property="editor" column="editor"/>
	           <result property="edit_date" column="edit_date"/>
	        </resultMap>
	        <resultMap type="userMsgDTO" id="userMsg">
	           <result property="msg_idx" column="msg_idx"/>
	           <result property="user_idx" column="user_idx"/>
	           <result property="msg_cntnt" column="msg_cntnt"/>
	           <result property="status" column="status"/>
	           <result property="writer" column="writer"/>
	           <result property="write_date" column="write_date"/>
	           <result property="editor" column="editor"/>
	           <result property="edit_date" column="edit_date"/>
	        </resultMap>
     	    <resultMap type="myAnswerDTO" id="myAnswer">
	           <result property="user_idx" column="user_idx"/>
	           <result property="ask_idx" column="ask_idx"/>
	           <result property="answer_idx" column="answer_idx"/>
	           <result property="ask_cntnt" column="ask_cntnt"/>
	           <result property="status" column="status"/>
	           <result property="writer" column="writer"/>
	           <result property="write_date" column="write_date"/>
	           <result property="editor" column="editor"/>
	           <result property="edit_date" column="edit_date"/>
	        </resultMap>
	               
        <insert id="insertNick">
        	INSERT INTO 
				 EZ_DIARY_USER
					(user_idx, user_nick, status, writer, write_date, editor, edit_date)
				 VALUES
					(user_idx_s.nextval, #{user_nick}, 'c', #{user_nick}, sysdate, #{user_nick}, sysdate)
        </insert>
  		
  		<select id="selectUser" resultType="int">
  			<![CDATA[
         	  select nvl(max(user_idx),0) from EZ_DIARY_USER
           ]]>
  		</select>
  		
		<select id="selectAsk" resultMap="ask">
			SELECT * FROM (
							SELECT 
								ASK_IDX 
							FROM 
								EZ_DIARY_ASK 
							ORDER BY 
								ASK_IDX ASC
						  )
					WHERE
						ROWNUM = 1
		</select>
		
		<select id="selectAnswer" resultMap="answer">
			<![CDATA[
				SELECT 
					* 
				FROM 
					EZ_DIARY_ASK_ANSWER 
				WHERE 
					ASK_IDX = 1 
				ORDER BY 
					ANSWER_IDX
			]]>
		</select>
  		      
        <select id="surveyAskList" parameterType="com.ezen.ezdiary.admin.dto.AdminAskDTO" resultMap="ask">
        	<![CDATA[ 
	        	SELECT * FROM 
	        		EZ_DIARY_ASK 
        		WHERE 
        			ASK_IDX = #{ask_idx}
        	]]>
        </select>
        
        <select id="surveyAnswerList" parameterType="com.ezen.ezdiary.admin.dto.AdminAnswerDTO" resultMap="answer">
        	<![CDATA[ 
	        	SELECT * FROM 
	        		EZ_DIARY_ASK_ANSWER 
        		WHERE 
        			ASK_IDX = #{ask_idx} 
       			ORDER BY 
       				ANSWER_IDX ASC
        	]]>
        </select>
        
        <select id="ajaxAskList" parameterType="com.ezen.ezdiary.admin.dto.AdminAskDTO" resultMap="ask">
        	<![CDATA[ 
				SELECT * FROM (
					SELECT * FROM 
						EZ_DIARY_ASK
					ORDER BY 
						ask_idx ASC 
					) 
				    WHERE 
				    	rownum = 1
				    AND 
				    	ask_idx > #{ask_idx} 	
        	]]>        	
        </select>
        
        
        <select id="ajaxAnswerList" parameterType="com.ezen.ezdiary.admin.dto.AdminAnswerDTO" resultMap="answer">
        	<![CDATA[ 
        		SELECT * FROM 
        			EZ_DIARY_ASK_ANSWER
        		WHERE
        			ASK_IDX = #{ask_idx} + 1
        		ORDER BY 
        			ANSWER_CNTNT
        	]]>        	
        </select>
		
		<select id="myAjaxAnswer" parameterType="com.ezen.ezdiary.admin.dto.AdminAnswerDTO" resultMap="answer">
        	<![CDATA[ 
        		SELECT * FROM 
        			EZ_DIARY_ASK_ANSWER
        		WHERE
        			ASK_IDX = #{ask_idx}
        		ORDER BY 
        			ANSWER_CNTNT
        	]]> 		
		</select>
		
        <insert id="insertMyAnswer">
        	INSERT INTO
        		EZ_DIARY_USER_ANSWER
        			(user_idx, ask_idx, answer_idx, answer_cntnt)
        		VALUES
        			(#{user_idx},#{ask_idx}, #{answer_idx}, #{answer_cntnt})
        </insert>
        
		<select id="myAnswer" parameterType="com.ezen.ezdiary.user.dto.MyAnswerDTO" resultMap="myAnswer">
			SELECT * FROM
				EZ_DIARY_USER_ANSWER
			WHERE 
				user_idx = #{user_idx}
		</select>
		
		<insert id="insertMsg">
			INSERT INTO 
				 EZ_DIARY_USER_MSG
					(MSG_IDX, USER_IDX, MSG_CNTNT, STATUS, WRITER, WRITE_DATE, EDITOR, EDIT_DATE)
				 VALUES
					(userMsg_idx_s.nextval, #{user_idx}, #{msg_cntnt}, 'C', #{user_idx}, sysdate , #{user_idx}, sysdate)
		</insert>
</mapper>